<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquitectura - Bot de Actas Teams</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #e4e4e7;
            padding: 2rem;
        }
        
        h1 {
            text-align: center;
            font-size: 2rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #60a5fa, #a78bfa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 2rem;
        }
        
        .tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .tab:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .tab.active {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-color: transparent;
        }
        
        .diagram-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255,255,255,0.03);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .diagram {
            display: none;
        }
        
        .diagram.active {
            display: block;
        }
        
        .diagram-title {
            font-size: 1.25rem;
            margin-bottom: 1.5rem;
            color: #f1f5f9;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .diagram-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(180deg, #3b82f6, #8b5cf6);
            border-radius: 2px;
        }
        
        svg {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .legend {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        
        .legend h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: #94a3b8;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        
        .description {
            margin-top: 1.5rem;
            padding: 1rem;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            border-radius: 0 8px 8px 0;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        /* Animaciones para SVG */
        .flow-arrow {
            animation: flowPulse 2s ease-in-out infinite;
        }
        
        @keyframes flowPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        .component:hover {
            filter: brightness(1.2);
            cursor: pointer;
        }
        
        /* Tooltip */
        .tooltip {
            position: fixed;
            background: #1e293b;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            max-width: 300px;
            z-index: 1000;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .tooltip.visible {
            opacity: 1;
        }
    </style>
</head>
<body>
    <h1>üéØ Arquitectura del Sistema de Actas Autom√°ticas</h1>
    <p class="subtitle">Bot de Microsoft Teams para transcripci√≥n y generaci√≥n de actas con IA</p>
    
    <div class="tabs">
        <div class="tab active" onclick="showDiagram('overview')">Vista General</div>
        <div class="tab" onclick="showDiagram('deployment')">Despliegue Azure</div>
        <div class="tab" onclick="showDiagram('sequence')">Flujo de Secuencia</div>
        <div class="tab" onclick="showDiagram('components')">Componentes Internos</div>
        <div class="tab" onclick="showDiagram('network')">Red y Seguridad</div>
    </div>
    
    <div class="diagram-container">
        <!-- DIAGRAMA 1: Vista General -->
        <div class="diagram active" id="overview">
            <h2 class="diagram-title">Arquitectura de Alto Nivel</h2>
            <svg viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="teamsGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#5c5cff"/>
                        <stop offset="100%" style="stop-color:#7b83eb"/>
                    </linearGradient>
                    <linearGradient id="azureGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#0078d4"/>
                        <stop offset="100%" style="stop-color:#00bcf2"/>
                    </linearGradient>
                    <linearGradient id="botGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#10b981"/>
                        <stop offset="100%" style="stop-color:#34d399"/>
                    </linearGradient>
                    <linearGradient id="aiGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#8b5cf6"/>
                        <stop offset="100%" style="stop-color:#a78bfa"/>
                    </linearGradient>
                    <linearGradient id="storageGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#f59e0b"/>
                        <stop offset="100%" style="stop-color:#fbbf24"/>
                    </linearGradient>
                    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="0" dy="4" stdDeviation="8" flood-opacity="0.3"/>
                    </filter>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#60a5fa"/>
                    </marker>
                </defs>
                
                <!-- Zona Usuario/Teams -->
                <rect x="30" y="30" width="280" height="640" rx="16" fill="rgba(92,92,255,0.1)" stroke="rgba(92,92,255,0.3)" stroke-width="2"/>
                <text x="170" y="65" text-anchor="middle" fill="#7b83eb" font-size="14" font-weight="600">MICROSOFT 365</text>
                
                <!-- Teams Meeting -->
                <g class="component" data-tooltip="Reuni√≥n de Microsoft Teams donde los usuarios participan. El bot se une como un participante m√°s.">
                    <rect x="60" y="100" width="220" height="100" rx="12" fill="url(#teamsGrad)" filter="url(#shadow)"/>
                    <text x="170" y="140" text-anchor="middle" fill="white" font-size="16" font-weight="600">üìπ Teams Meeting</text>
                    <text x="170" y="165" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">Reuni√≥n con participantes</text>
                    <text x="170" y="185" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="11">Audio Stream por usuario</text>
                </g>
                
                <!-- Graph API -->
                <g class="component" data-tooltip="Microsoft Graph API: proporciona acceso a datos de usuario, llamadas y SharePoint. Requiere permisos de aplicaci√≥n.">
                    <rect x="60" y="240" width="220" height="80" rx="12" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="170" y="275" text-anchor="middle" fill="white" font-size="15" font-weight="600">üîó Microsoft Graph API</text>
                    <text x="170" y="300" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">Communications + Users + Sites</text>
                </g>
                
                <!-- SharePoint -->
                <g class="component" data-tooltip="SharePoint: almacenamiento final de las actas. Se suben como archivos .md a una biblioteca de documentos.">
                    <rect x="60" y="540" width="220" height="100" rx="12" fill="url(#storageGrad)" filter="url(#shadow)"/>
                    <text x="170" y="580" text-anchor="middle" fill="white" font-size="16" font-weight="600">üìÅ SharePoint</text>
                    <text x="170" y="605" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">Biblioteca de Documentos</text>
                    <text x="170" y="625" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="11">/sites/Actas/</text>
                </g>
                
                <!-- Zona Azure -->
                <rect x="350" y="30" width="500" height="640" rx="16" fill="rgba(0,120,212,0.1)" stroke="rgba(0,120,212,0.3)" stroke-width="2"/>
                <text x="600" y="65" text-anchor="middle" fill="#00bcf2" font-size="14" font-weight="600">AZURE CLOUD</text>
                
                <!-- Azure Bot Service -->
                <g class="component" data-tooltip="Azure Bot Service: gestiona el registro del bot, canales (Teams) y enrutamiento de mensajes.">
                    <rect x="380" y="100" width="200" height="80" rx="12" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="480" y="135" text-anchor="middle" fill="white" font-size="14" font-weight="600">ü§ñ Azure Bot Service</text>
                    <text x="480" y="158" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">Bot Channel Registration</text>
                </g>
                
                <!-- Container/Compute -->
                <g class="component" data-tooltip="Compute: donde corre el c√≥digo del bot (ACI, AKS o VM). Debe tener suficiente CPU para Whisper.">
                    <rect x="380" y="220" width="200" height="120" rx="12" fill="url(#botGrad)" filter="url(#shadow)"/>
                    <text x="480" y="258" text-anchor="middle" fill="white" font-size="14" font-weight="600">üê≥ Bot Container</text>
                    <text x="480" y="283" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">Python 3.9+ / Docker</text>
                    <text x="480" y="303" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="10">‚Ä¢ bot.py (orquestador)</text>
                    <text x="480" y="320" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="10">‚Ä¢ audio_handler.py</text>
                </g>
                
                <!-- Whisper -->
                <g class="component" data-tooltip="Whisper: modelo de OpenAI para Speech-to-Text. Se ejecuta localmente en el container (modelo base ~1.5GB).">
                    <rect x="380" y="380" width="200" height="80" rx="12" fill="url(#aiGrad)" filter="url(#shadow)"/>
                    <text x="480" y="415" text-anchor="middle" fill="white" font-size="14" font-weight="600">üé§ Whisper STT</text>
                    <text x="480" y="440" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">Transcripci√≥n Local</text>
                </g>
                
                <!-- Blob Storage -->
                <g class="component" data-tooltip="Azure Blob Storage: almacena temporalmente los archivos WAV durante el procesamiento.">
                    <rect x="620" y="220" width="200" height="80" rx="12" fill="url(#storageGrad)" filter="url(#shadow)"/>
                    <text x="720" y="255" text-anchor="middle" fill="white" font-size="14" font-weight="600">üíæ Blob Storage</text>
                    <text x="720" y="278" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">WAV temporales</text>
                </g>
                
                <!-- Azure AD -->
                <g class="component" data-tooltip="Azure Active Directory: autenticaci√≥n del bot mediante Client Credentials (App Registration).">
                    <rect x="620" y="100" width="200" height="80" rx="12" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="720" y="135" text-anchor="middle" fill="white" font-size="14" font-weight="600">üîê Azure AD</text>
                    <text x="720" y="158" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">App Registration</text>
                </g>
                
                <!-- LLM Zone -->
                <rect x="890" y="30" width="280" height="400" rx="16" fill="rgba(139,92,246,0.1)" stroke="rgba(139,92,246,0.3)" stroke-width="2"/>
                <text x="1030" y="65" text-anchor="middle" fill="#a78bfa" font-size="14" font-weight="600">SERVICIOS IA EXTERNOS</text>
                
                <!-- OpenAI/Claude -->
                <g class="component" data-tooltip="LLM (GPT-4 o Claude): recibe la transcripci√≥n completa y genera el acta estructurada en Markdown.">
                    <rect x="920" y="100" width="220" height="100" rx="12" fill="url(#aiGrad)" filter="url(#shadow)"/>
                    <text x="1030" y="140" text-anchor="middle" fill="white" font-size="16" font-weight="600">üß† LLM API</text>
                    <text x="1030" y="165" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="12">GPT-4 / Claude</text>
                    <text x="1030" y="185" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="11">Generaci√≥n de Actas</text>
                </g>
                
                <!-- Flechas de flujo -->
                <!-- Teams -> Graph -->
                <path d="M170 200 L170 235" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- Graph -> Bot -->
                <path d="M280 280 L375 280" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- Bot -> Whisper -->
                <path d="M480 340 L480 375" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- Bot -> Blob -->
                <path d="M580 280 L615 260" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- Bot -> Azure AD -->
                <path d="M540 140 L615 140" stroke="#60a5fa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- Whisper -> LLM -->
                <path d="M580 420 L850 200 L915 150" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- LLM -> SharePoint -->
                <path d="M920 180 L850 480 L280 590" stroke="#f59e0b" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                
                <!-- Labels en flechas -->
                <text x="185" y="225" fill="#94a3b8" font-size="10">Media Stream</text>
                <text x="305" y="270" fill="#94a3b8" font-size="10">Audio + User IDs</text>
                <text x="490" y="365" fill="#94a3b8" font-size="10">WAV files</text>
                <text x="750" y="350" fill="#94a3b8" font-size="10">Transcripci√≥n</text>
                <text x="650" y="530" fill="#94a3b8" font-size="10">Acta .md</text>
            </svg>
            
            <div class="legend">
                <h3>Leyenda de Componentes</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #5c5cff, #7b83eb)"></div>
                        <span>Microsoft Teams</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #0078d4, #00bcf2)"></div>
                        <span>Servicios Azure</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #10b981, #34d399)"></div>
                        <span>Bot Container</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa)"></div>
                        <span>Servicios IA</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: linear-gradient(135deg, #f59e0b, #fbbf24)"></div>
                        <span>Almacenamiento</span>
                    </div>
                </div>
            </div>
            
            <div class="description">
                <strong>Descripci√≥n:</strong> El sistema act√∫a como un participante virtual que se une a reuniones de Teams. 
                Captura el audio separado por participante (diarizaci√≥n nativa), lo transcribe con Whisper, 
                genera un acta estructurada con un LLM y la almacena en SharePoint.
            </div>
        </div>
        
        <!-- DIAGRAMA 2: Despliegue Azure -->
        <div class="diagram" id="deployment">
            <h2 class="diagram-title">Arquitectura de Despliegue en Azure</h2>
            <svg viewBox="0 0 1200 750" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="rgGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#374151"/>
                        <stop offset="100%" style="stop-color:#4b5563"/>
                    </linearGradient>
                </defs>
                
                <!-- Resource Group Principal -->
                <rect x="50" y="50" width="700" height="650" rx="20" fill="rgba(55,65,81,0.3)" stroke="#6b7280" stroke-width="2" stroke-dasharray="10,5"/>
                <text x="80" y="85" fill="#9ca3af" font-size="14" font-weight="600">üì¶ Resource Group: rg-bot-actas-prod</text>
                
                <!-- VNet -->
                <rect x="80" y="110" width="640" height="320" rx="16" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2"/>
                <text x="110" y="140" fill="#60a5fa" font-size="13" font-weight="600">üåê Virtual Network: vnet-bot-actas</text>
                <text x="110" y="160" fill="#94a3b8" font-size="11">10.0.0.0/16</text>
                
                <!-- Subnet Compute -->
                <rect x="110" y="180" width="280" height="220" rx="12" fill="rgba(16,185,129,0.1)" stroke="#10b981" stroke-width="1"/>
                <text x="130" y="205" fill="#34d399" font-size="12" font-weight="600">Subnet: snet-compute (10.0.1.0/24)</text>
                
                <!-- ACI -->
                <g class="component" data-tooltip="Azure Container Instances: opci√≥n simple para despliegue. Ideal para cargas bajas-medias sin orquestaci√≥n compleja.">
                    <rect x="130" y="225" width="240" height="70" rx="10" fill="url(#botGrad)" filter="url(#shadow)"/>
                    <text x="250" y="255" text-anchor="middle" fill="white" font-size="13" font-weight="600">üê≥ Container Instance</text>
                    <text x="250" y="278" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">aci-bot-actas | 4 vCPU, 8GB RAM</text>
                </g>
                
                <!-- AKS alternativa -->
                <g class="component" data-tooltip="Azure Kubernetes Service: alternativa para alta disponibilidad y escalabilidad. Recomendado si hay muchas reuniones simult√°neas.">
                    <rect x="130" y="310" width="240" height="70" rx="10" fill="rgba(16,185,129,0.3)" stroke="#10b981" stroke-width="1" stroke-dasharray="5,3"/>
                    <text x="250" y="340" text-anchor="middle" fill="#34d399" font-size="13" font-weight="600">‚ò∏Ô∏è AKS (Alternativa)</text>
                    <text x="250" y="363" text-anchor="middle" fill="#6ee7b7" font-size="10">aks-bot-actas | Node pool D4s_v3</text>
                </g>
                
                <!-- Subnet Storage -->
                <rect x="420" y="180" width="280" height="220" rx="12" fill="rgba(245,158,11,0.1)" stroke="#f59e0b" stroke-width="1"/>
                <text x="440" y="205" fill="#fbbf24" font-size="12" font-weight="600">Subnet: snet-data (10.0.2.0/24)</text>
                
                <!-- Blob Storage -->
                <g class="component" data-tooltip="Azure Blob Storage: almacena temporalmente archivos WAV. Container 'audio-temp' con pol√≠tica de retenci√≥n de 24h.">
                    <rect x="440" y="225" width="240" height="70" rx="10" fill="url(#storageGrad)" filter="url(#shadow)"/>
                    <text x="560" y="255" text-anchor="middle" fill="white" font-size="13" font-weight="600">üíæ Storage Account</text>
                    <text x="560" y="278" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">stbotactasprod | Blob Container</text>
                </g>
                
                <!-- Key Vault -->
                <g class="component" data-tooltip="Azure Key Vault: almacena secretos (Client Secret, API Keys de OpenAI). El container accede via Managed Identity.">
                    <rect x="440" y="310" width="240" height="70" rx="10" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="560" y="340" text-anchor="middle" fill="white" font-size="13" font-weight="600">üîë Key Vault</text>
                    <text x="560" y="363" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">kv-bot-actas | Secrets + Managed Identity</text>
                </g>
                
                <!-- Servicios PaaS (fuera de VNet) -->
                <text x="80" y="465" fill="#9ca3af" font-size="13" font-weight="600">Servicios PaaS (Azure Backbone)</text>
                
                <!-- Bot Service -->
                <g class="component" data-tooltip="Azure Bot Service: punto de entrada desde Teams. Configura el Messaging Endpoint hacia el container.">
                    <rect x="80" y="485" width="200" height="80" rx="10" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="180" y="520" text-anchor="middle" fill="white" font-size="13" font-weight="600">ü§ñ Bot Service</text>
                    <text x="180" y="545" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">bot-actas-teams</text>
                </g>
                
                <!-- App Registration -->
                <g class="component" data-tooltip="Azure AD App Registration: identidad del bot. Contiene los permisos de Graph API y Client Credentials.">
                    <rect x="310" y="485" width="200" height="80" rx="10" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="410" y="520" text-anchor="middle" fill="white" font-size="13" font-weight="600">üîê App Registration</text>
                    <text x="410" y="545" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">app-bot-actas (Azure AD)</text>
                </g>
                
                <!-- Application Insights -->
                <g class="component" data-tooltip="Application Insights: monitoreo y logging. Traza las peticiones, errores y m√©tricas de rendimiento del bot.">
                    <rect x="540" y="485" width="200" height="80" rx="10" fill="#ec4899" filter="url(#shadow)"/>
                    <text x="640" y="520" text-anchor="middle" fill="white" font-size="13" font-weight="600">üìä App Insights</text>
                    <text x="640" y="545" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">appi-bot-actas</text>
                </g>
                
                <!-- Log Analytics -->
                <g class="component" data-tooltip="Log Analytics Workspace: centraliza logs de todos los componentes para an√°lisis y alertas.">
                    <rect x="80" y="590" width="200" height="80" rx="10" fill="#6366f1" filter="url(#shadow)"/>
                    <text x="180" y="625" text-anchor="middle" fill="white" font-size="13" font-weight="600">üìã Log Analytics</text>
                    <text x="180" y="650" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">log-bot-actas</text>
                </g>
                
                <!-- Container Registry -->
                <g class="component" data-tooltip="Azure Container Registry: almacena la imagen Docker del bot. CI/CD pushea nuevas versiones aqu√≠.">
                    <rect x="310" y="590" width="200" height="80" rx="10" fill="#0891b2" filter="url(#shadow)"/>
                    <text x="410" y="625" text-anchor="middle" fill="white" font-size="13" font-weight="600">üì¶ Container Registry</text>
                    <text x="410" y="650" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">crbotactas.azurecr.io</text>
                </g>
                
                <!-- External Services -->
                <rect x="790" y="50" width="370" height="650" rx="20" fill="rgba(139,92,246,0.1)" stroke="#8b5cf6" stroke-width="2"/>
                <text x="820" y="85" fill="#a78bfa" font-size="14" font-weight="600">‚òÅÔ∏è Servicios Externos</text>
                
                <!-- Microsoft 365 -->
                <g class="component" data-tooltip="Microsoft 365 Tenant: incluye Teams (reuniones), SharePoint (almacenamiento) y Azure AD (autenticaci√≥n).">
                    <rect x="820" y="120" width="310" height="120" rx="12" fill="url(#teamsGrad)" filter="url(#shadow)"/>
                    <text x="975" y="160" text-anchor="middle" fill="white" font-size="15" font-weight="600">Microsoft 365</text>
                    <text x="880" y="190" fill="rgba(255,255,255,0.8)" font-size="11">üìπ Teams</text>
                    <text x="975" y="190" fill="rgba(255,255,255,0.8)" font-size="11">üìÅ SharePoint</text>
                    <text x="1070" y="190" fill="rgba(255,255,255,0.8)" font-size="11">üë• Users</text>
                    <text x="975" y="220" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="10">graph.microsoft.com</text>
                </g>
                
                <!-- OpenAI -->
                <g class="component" data-tooltip="OpenAI API: servicio externo para GPT-4. Alternativa: Azure OpenAI Service para mayor control y compliance.">
                    <rect x="820" y="270" width="310" height="90" rx="12" fill="url(#aiGrad)" filter="url(#shadow)"/>
                    <text x="975" y="310" text-anchor="middle" fill="white" font-size="15" font-weight="600">üß† OpenAI API</text>
                    <text x="975" y="338" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">GPT-4 / GPT-4 Turbo</text>
                </g>
                
                <!-- Azure OpenAI alternativa -->
                <g class="component" data-tooltip="Azure OpenAI Service: alternativa empresarial. Datos no salen del tenant, mejor para compliance.">
                    <rect x="820" y="380" width="310" height="90" rx="12" fill="rgba(139,92,246,0.3)" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="5,3"/>
                    <text x="975" y="420" text-anchor="middle" fill="#a78bfa" font-size="14" font-weight="600">üè¢ Azure OpenAI (Alternativa)</text>
                    <text x="975" y="448" text-anchor="middle" fill="#c4b5fd" font-size="11">oai-bot-actas.openai.azure.com</text>
                </g>
                
                <!-- Conexiones -->
                <path d="M370 265 L420 265" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <path d="M370 345 L420 345" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <path d="M280 525 L305 525" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <path d="M180 565 L180 585" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowhead)"/>
                <path d="M640 565 L640 400 L700 360" stroke="#60a5fa" stroke-width="2" fill="none"/>
                
                <!-- Flecha a M365 -->
                <path d="M720 280 L815 200" stroke="#7b83eb" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                <text x="750" y="225" fill="#94a3b8" font-size="10">Graph API</text>
                
                <!-- Flecha a OpenAI -->
                <path d="M680 300 L815 315" stroke="#a78bfa" stroke-width="3" fill="none" marker-end="url(#arrowhead)" class="flow-arrow"/>
                <text x="730" y="295" fill="#94a3b8" font-size="10">API Calls</text>
            </svg>
            
            <div class="legend">
                <h3>Recursos Azure Requeridos</h3>
                <div class="legend-items">
                    <div class="legend-item"><span>‚Ä¢ Container Instance o AKS</span></div>
                    <div class="legend-item"><span>‚Ä¢ Storage Account (Blob)</span></div>
                    <div class="legend-item"><span>‚Ä¢ Key Vault</span></div>
                    <div class="legend-item"><span>‚Ä¢ Bot Service</span></div>
                    <div class="legend-item"><span>‚Ä¢ App Registration (Azure AD)</span></div>
                    <div class="legend-item"><span>‚Ä¢ Application Insights</span></div>
                    <div class="legend-item"><span>‚Ä¢ Container Registry</span></div>
                    <div class="legend-item"><span>‚Ä¢ Virtual Network + NSG</span></div>
                </div>
            </div>
            
            <div class="description">
                <strong>Estimaci√≥n de costes:</strong> ~$150-300/mes para carga baja-media. 
                ACI es m√°s econ√≥mico para pocas reuniones; AKS escala mejor con alta demanda. 
                Los componentes con borde punteado son alternativas opcionales.
            </div>
        </div>
        
        <!-- DIAGRAMA 3: Secuencia -->
        <div class="diagram" id="sequence">
            <h2 class="diagram-title">Diagrama de Secuencia - Flujo Completo</h2>
            <svg viewBox="0 0 1200 900" xmlns="http://www.w3.org/2000/svg">
                <!-- Actores -->
                <g>
                    <!-- Usuario -->
                    <rect x="80" y="30" width="100" height="50" rx="8" fill="url(#teamsGrad)"/>
                    <text x="130" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">üë§ Usuario</text>
                    <line x1="130" y1="80" x2="130" y2="850" stroke="#5c5cff" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Teams -->
                    <rect x="230" y="30" width="100" height="50" rx="8" fill="url(#teamsGrad)"/>
                    <text x="280" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">üìπ Teams</text>
                    <line x1="280" y1="80" x2="280" y2="850" stroke="#7b83eb" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Graph API -->
                    <rect x="380" y="30" width="100" height="50" rx="8" fill="url(#azureGrad)"/>
                    <text x="430" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">üîó Graph</text>
                    <line x1="430" y1="80" x2="430" y2="850" stroke="#0078d4" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Bot -->
                    <rect x="530" y="30" width="100" height="50" rx="8" fill="url(#botGrad)"/>
                    <text x="580" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">ü§ñ Bot</text>
                    <line x1="580" y1="80" x2="580" y2="850" stroke="#10b981" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- Whisper -->
                    <rect x="680" y="30" width="100" height="50" rx="8" fill="url(#aiGrad)"/>
                    <text x="730" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">üé§ Whisper</text>
                    <line x1="730" y1="80" x2="730" y2="850" stroke="#8b5cf6" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- LLM -->
                    <rect x="830" y="30" width="100" height="50" rx="8" fill="url(#aiGrad)"/>
                    <text x="880" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">üß† LLM</text>
                    <line x1="880" y1="80" x2="880" y2="850" stroke="#a78bfa" stroke-width="2" stroke-dasharray="5,5"/>
                    
                    <!-- SharePoint -->
                    <rect x="980" y="30" width="100" height="50" rx="8" fill="url(#storageGrad)"/>
                    <text x="1030" y="60" text-anchor="middle" fill="white" font-size="12" font-weight="600">üìÅ SharePoint</text>
                    <line x1="1030" y1="80" x2="1030" y2="850" stroke="#f59e0b" stroke-width="2" stroke-dasharray="5,5"/>
                </g>
                
                <!-- Fase 1: Inicio de reuni√≥n -->
                <rect x="50" y="95" width="1100" height="130" rx="8" fill="rgba(92,92,255,0.1)"/>
                <text x="70" y="115" fill="#7b83eb" font-size="11" font-weight="600">FASE 1: INICIO DE REUNI√ìN</text>
                
                <line x1="130" y1="130" x2="270" y2="130" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="200" y="125" text-anchor="middle" fill="#94a3b8" font-size="10">Inicia reuni√≥n</text>
                
                <line x1="280" y1="150" x2="420" y2="150" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="350" y="145" text-anchor="middle" fill="#94a3b8" font-size="10">Notifica inicio</text>
                
                <line x1="430" y1="170" x2="570" y2="170" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="500" y="165" text-anchor="middle" fill="#94a3b8" font-size="10">joinMeeting(url)</text>
                
                <line x1="570" y1="190" x2="290" y2="190" stroke="#34d399" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="430" y="205" text-anchor="middle" fill="#94a3b8" font-size="10">Bot se une como participante</text>
                
                <!-- Fase 2: Captura de audio -->
                <rect x="50" y="235" width="1100" height="180" rx="8" fill="rgba(16,185,129,0.1)"/>
                <text x="70" y="255" fill="#34d399" font-size="11" font-weight="600">FASE 2: CAPTURA DE AUDIO (durante la reuni√≥n)</text>
                
                <rect x="260" y="270" width="340" height="60" rx="6" fill="rgba(96,165,250,0.2)" stroke="#60a5fa" stroke-width="1"/>
                <text x="430" y="295" text-anchor="middle" fill="#60a5fa" font-size="11">üîÑ Loop: Por cada paquete de audio</text>
                
                <line x1="280" y1="340" x2="420" y2="340" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="350" y="335" text-anchor="middle" fill="#94a3b8" font-size="10">audioPacket(participantId, data)</text>
                
                <line x1="430" y1="360" x2="570" y2="360" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="500" y="355" text-anchor="middle" fill="#94a3b8" font-size="10">process_packet()</text>
                
                <text x="590" y="380" fill="#6ee7b7" font-size="10">buffers[participantId].append(data)</text>
                
                <line x1="130" y1="400" x2="270" y2="400" stroke="#f87171" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="200" y="395" text-anchor="middle" fill="#f87171" font-size="10">Finaliza reuni√≥n</text>
                
                <!-- Fase 3: Procesamiento -->
                <rect x="50" y="425" width="1100" height="260" rx="8" fill="rgba(139,92,246,0.1)"/>
                <text x="70" y="445" fill="#a78bfa" font-size="11" font-weight="600">FASE 3: PROCESAMIENTO POST-REUNI√ìN</text>
                
                <line x1="280" y1="465" x2="570" y2="465" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="425" y="460" text-anchor="middle" fill="#94a3b8" font-size="10">on_call_ended()</text>
                
                <text x="590" y="485" fill="#6ee7b7" font-size="10">save_final_wavs() ‚Üí participant1.wav, participant2.wav...</text>
                
                <line x1="580" y1="505" x2="420" y2="505" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="500" y="500" text-anchor="middle" fill="#94a3b8" font-size="10">get_participant_profile(id)</text>
                
                <line x1="430" y1="525" x2="570" y2="525" stroke="#34d399" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="500" y="540" text-anchor="middle" fill="#94a3b8" font-size="10">"Juan Garc√≠a"</text>
                
                <line x1="580" y1="560" x2="720" y2="560" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="650" y="555" text-anchor="middle" fill="#94a3b8" font-size="10">transcribe(wav)</text>
                
                <line x1="730" y1="580" x2="590" y2="580" stroke="#c4b5fd" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="660" y="595" text-anchor="middle" fill="#94a3b8" font-size="10">[{text, start, end}]</text>
                
                <text x="590" y="615" fill="#6ee7b7" font-size="10">Ordenar segmentos cronol√≥gicamente + a√±adir speaker</text>
                
                <line x1="580" y1="635" x2="870" y2="635" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="725" y="630" text-anchor="middle" fill="#94a3b8" font-size="10">generate(transcripci√≥n)</text>
                
                <line x1="880" y1="655" x2="590" y2="655" stroke="#c4b5fd" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="735" y="670" text-anchor="middle" fill="#94a3b8" font-size="10">Acta en Markdown</text>
                
                <!-- Fase 4: Almacenamiento -->
                <rect x="50" y="695" width="1100" height="150" rx="8" fill="rgba(245,158,11,0.1)"/>
                <text x="70" y="715" fill="#fbbf24" font-size="11" font-weight="600">FASE 4: ALMACENAMIENTO Y NOTIFICACI√ìN</text>
                
                <line x1="580" y1="740" x2="1020" y2="740" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="800" y="735" text-anchor="middle" fill="#94a3b8" font-size="10">upload_minutes(acta.md)</text>
                
                <line x1="1030" y1="760" x2="590" y2="760" stroke="#fbbf24" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="810" y="775" text-anchor="middle" fill="#94a3b8" font-size="10">URL del documento</text>
                
                <line x1="580" y1="795" x2="290" y2="795" stroke="#34d399" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="435" y="790" text-anchor="middle" fill="#94a3b8" font-size="10">send_activity("‚úÖ Acta lista: {url}")</text>
                
                <line x1="280" y1="815" x2="140" y2="815" stroke="#7b83eb" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="210" y="830" text-anchor="middle" fill="#94a3b8" font-size="10">Mensaje en chat</text>
            </svg>
            
            <div class="description">
                <strong>Tiempos estimados:</strong> Fase 1 (2-5s), Fase 2 (duraci√≥n de la reuni√≥n), 
                Fase 3 (30s-5min seg√∫n duraci√≥n del audio y modelo Whisper), Fase 4 (2-5s).
                El procesamiento es as√≠ncrono tras finalizar la reuni√≥n.
            </div>
        </div>
        
        <!-- DIAGRAMA 4: Componentes Internos -->
        <div class="diagram" id="components">
            <h2 class="diagram-title">Componentes Internos del Bot</h2>
            <svg viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg">
                <!-- Container principal -->
                <rect x="50" y="50" width="1100" height="600" rx="20" fill="rgba(16,185,129,0.1)" stroke="#10b981" stroke-width="2"/>
                <text x="80" y="85" fill="#34d399" font-size="16" font-weight="600">üê≥ Bot Container (Python 3.9+)</text>
                
                <!-- M√≥dulo config.py -->
                <g class="component" data-tooltip="config.py: Carga variables de entorno y centraliza la configuraci√≥n. Usa dataclass para tipado.">
                    <rect x="80" y="110" width="200" height="100" rx="10" fill="#374151" filter="url(#shadow)"/>
                    <text x="180" y="145" text-anchor="middle" fill="#f59e0b" font-size="14" font-weight="600">‚öôÔ∏è config.py</text>
                    <text x="180" y="170" text-anchor="middle" fill="#9ca3af" font-size="10">APP_ID, APP_PASSWORD</text>
                    <text x="180" y="185" text-anchor="middle" fill="#9ca3af" font-size="10">TENANT_ID, WHISPER_MODEL</text>
                    <text x="180" y="200" text-anchor="middle" fill="#9ca3af" font-size="10">SHAREPOINT_URL, LLM_MODEL</text>
                </g>
                
                <!-- M√≥dulo bot.py -->
                <g class="component" data-tooltip="bot.py: Orquestador principal. Clase MeetingBot con callbacks on_call_started, on_audio_packet, on_call_ended.">
                    <rect x="500" y="110" width="200" height="140" rx="10" fill="#10b981" filter="url(#shadow)"/>
                    <text x="600" y="145" text-anchor="middle" fill="white" font-size="14" font-weight="600">üéØ bot.py</text>
                    <text x="600" y="170" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">MeetingBot</text>
                    <text x="600" y="190" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ on_call_started()</text>
                    <text x="600" y="205" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ on_audio_packet()</text>
                    <text x="600" y="220" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ on_call_ended()</text>
                    <text x="600" y="235" text-anchor="middle" fill="rgba(255,255,255,0.6)" font-size="9">(Orquesta todo el pipeline)</text>
                </g>
                
                <!-- M√≥dulo graph_client.py -->
                <g class="component" data-tooltip="graph_client.py: Cliente async para Microsoft Graph. M√©todos join_meeting(), get_participant_profile().">
                    <rect x="80" y="250" width="200" height="120" rx="10" fill="#0078d4" filter="url(#shadow)"/>
                    <text x="180" y="285" text-anchor="middle" fill="white" font-size="14" font-weight="600">üîó graph_client.py</text>
                    <text x="180" y="310" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">GraphAPIClient</text>
                    <text x="180" y="330" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ get_token()</text>
                    <text x="180" y="345" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ join_meeting(url)</text>
                    <text x="180" y="360" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ get_participant_profile(id)</text>
                </g>
                
                <!-- M√≥dulo audio_handler.py -->
                <g class="component" data-tooltip="audio_handler.py: Gestiona buffers de audio por participante. Guarda WAV al finalizar la reuni√≥n.">
                    <rect x="310" y="250" width="200" height="120" rx="10" fill="#059669" filter="url(#shadow)"/>
                    <text x="410" y="285" text-anchor="middle" fill="white" font-size="14" font-weight="600">üéµ audio_handler.py</text>
                    <text x="410" y="310" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">AudioHandler</text>
                    <text x="410" y="330" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ buffers: Dict[str, bytes]</text>
                    <text x="410" y="345" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ process_packet(pkt)</text>
                    <text x="410" y="360" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ save_final_wavs()</text>
                </g>
                
                <!-- M√≥dulo whisper_service.py -->
                <g class="component" data-tooltip="whisper_service.py: Wrapper sobre OpenAI Whisper. Transcribe WAV y retorna segmentos con timestamps.">
                    <rect x="540" y="280" width="200" height="120" rx="10" fill="#8b5cf6" filter="url(#shadow)"/>
                    <text x="640" y="315" text-anchor="middle" fill="white" font-size="14" font-weight="600">üé§ whisper_service.py</text>
                    <text x="640" y="340" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">WhisperService</text>
                    <text x="640" y="360" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ model: whisper.Model</text>
                    <text x="640" y="375" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ transcribe(path) ‚Üí segments</text>
                    <text x="640" y="390" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ transcribe_with_speaker()</text>
                </g>
                
                <!-- M√≥dulo llm_service.py -->
                <g class="component" data-tooltip="llm_service.py: Genera actas con GPT-4/Claude. Contiene el SYSTEM_PROMPT optimizado.">
                    <rect x="770" y="280" width="200" height="120" rx="10" fill="#7c3aed" filter="url(#shadow)"/>
                    <text x="870" y="315" text-anchor="middle" fill="white" font-size="14" font-weight="600">üß† llm_service.py</text>
                    <text x="870" y="340" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">LLMService</text>
                    <text x="870" y="360" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ SYSTEM_PROMPT</text>
                    <text x="870" y="375" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ generate(transcript)</text>
                    <text x="870" y="390" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ generate_with_sections()</text>
                </g>
                
                <!-- M√≥dulo sharepoint_service.py -->
                <g class="component" data-tooltip="sharepoint_service.py: Sube archivos a SharePoint via Graph API. Resuelve Site ID desde URL.">
                    <rect x="920" y="110" width="200" height="120" rx="10" fill="#f59e0b" filter="url(#shadow)"/>
                    <text x="1020" y="145" text-anchor="middle" fill="white" font-size="14" font-weight="600">üìÅ sharepoint_service.py</text>
                    <text x="1020" y="170" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">SharePointService</text>
                    <text x="1020" y="190" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ _get_site_id()</text>
                    <text x="1020" y="205" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Ä¢ upload_minutes(name, md)</text>
                    <text x="1020" y="220" text-anchor="middle" fill="rgba(255,255,255,0.7)" font-size="10">‚Üí Returns: SharePoint URL</text>
                </g>
                
                <!-- Dependencias externas -->
                <text x="80" y="440" fill="#9ca3af" font-size="13" font-weight="600">üì¶ Dependencias Externas</text>
                
                <rect x="80" y="460" width="150" height="50" rx="8" fill="#1e3a5f"/>
                <text x="155" y="490" text-anchor="middle" fill="#60a5fa" font-size="11">azure-identity</text>
                
                <rect x="250" y="460" width="150" height="50" rx="8" fill="#1e3a5f"/>
                <text x="325" y="490" text-anchor="middle" fill="#60a5fa" font-size="11">aiohttp</text>
                
                <rect x="420" y="460" width="150" height="50" rx="8" fill="#1e3a5f"/>
                <text x="495" y="490" text-anchor="middle" fill="#60a5fa" font-size="11">botbuilder-core</text>
                
                <rect x="590" y="460" width="150" height="50" rx="8" fill="#1e3a5f"/>
                <text x="665" y="490" text-anchor="middle" fill="#60a5fa" font-size="11">openai-whisper</text>
                
                <rect x="760" y="460" width="150" height="50" rx="8" fill="#1e3a5f"/>
                <text x="835" y="490" text-anchor="middle" fill="#60a5fa" font-size="11">openai (SDK)</text>
                
                <!-- Archivos adicionales -->
                <text x="80" y="545" fill="#9ca3af" font-size="13" font-weight="600">üìÑ Archivos de Configuraci√≥n</text>
                
                <rect x="80" y="565" width="180" height="70" rx="8" fill="#374151"/>
                <text x="170" y="595" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="500">requirements.txt</text>
                <text x="170" y="615" text-anchor="middle" fill="#9ca3af" font-size="10">Dependencias Python</text>
                
                <rect x="280" y="565" width="180" height="70" rx="8" fill="#374151"/>
                <text x="370" y="595" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="500">Dockerfile</text>
                <text x="370" y="615" text-anchor="middle" fill="#9ca3af" font-size="10">Python 3.9 + FFmpeg</text>
                
                <rect x="480" y="565" width="180" height="70" rx="8" fill="#374151"/>
                <text x="570" y="595" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="500">.env</text>
                <text x="570" y="615" text-anchor="middle" fill="#9ca3af" font-size="10">Variables de entorno</text>
                
                <rect x="680" y="565" width="180" height="70" rx="8" fill="#374151"/>
                <text x="770" y="595" text-anchor="middle" fill="#fbbf24" font-size="12" font-weight="500">docker-compose.yml</text>
                <text x="770" y="615" text-anchor="middle" fill="#9ca3af" font-size="10">Orquestaci√≥n local</text>
                
                <!-- Flechas de dependencia -->
                <line x1="280" y1="160" x2="495" y2="160" stroke="#6b7280" stroke-width="1" marker-end="url(#arrowhead)"/>
                <line x1="180" y1="250" x2="500" y2="195" stroke="#6b7280" stroke-width="1" marker-end="url(#arrowhead)"/>
                <line x1="410" y1="250" x2="540" y2="210" stroke="#6b7280" stroke-width="1" marker-end="url(#arrowhead)"/>
                <line x1="600" y1="250" x2="640" y2="280" stroke="#6b7280" stroke-width="1" marker-end="url(#arrowhead)"/>
                <line x1="700" y1="200" x2="770" y2="300" stroke="#6b7280" stroke-width="1" marker-end="url(#arrowhead)"/>
                <line x1="700" y1="180" x2="920" y2="170" stroke="#6b7280" stroke-width="1" marker-end="url(#arrowhead)"/>
            </svg>
            
            <div class="description">
                <strong>Patr√≥n de dise√±o:</strong> Cada servicio es independiente e inyectable. 
                El orquestador (bot.py) coordina el flujo. Todos los servicios usan async/await para no bloquear.
            </div>
        </div>
        
        <!-- DIAGRAMA 5: Red y Seguridad -->
        <div class="diagram" id="network">
            <h2 class="diagram-title">Arquitectura de Red y Seguridad</h2>
            <svg viewBox="0 0 1200 700" xmlns="http://www.w3.org/2000/svg">
                <!-- Internet -->
                <rect x="500" y="20" width="200" height="50" rx="25" fill="#ef4444"/>
                <text x="600" y="52" text-anchor="middle" fill="white" font-size="14" font-weight="600">üåê Internet</text>
                
                <!-- Azure Firewall / WAF -->
                <rect x="450" y="100" width="300" height="60" rx="10" fill="#dc2626" filter="url(#shadow)"/>
                <text x="600" y="135" text-anchor="middle" fill="white" font-size="13" font-weight="600">üõ°Ô∏è Azure WAF / Application Gateway</text>
                
                <!-- L√≠nea de Internet a WAF -->
                <line x1="600" y1="70" x2="600" y2="100" stroke="#ef4444" stroke-width="3"/>
                
                <!-- VNet -->
                <rect x="100" y="190" width="600" height="460" rx="16" fill="rgba(59,130,246,0.1)" stroke="#3b82f6" stroke-width="2"/>
                <text x="130" y="220" fill="#60a5fa" font-size="14" font-weight="600">üîí Virtual Network (10.0.0.0/16)</text>
                
                <!-- NSG Badge -->
                <rect x="620" y="200" width="60" height="25" rx="4" fill="#ef4444"/>
                <text x="650" y="217" text-anchor="middle" fill="white" font-size="10" font-weight="600">NSG</text>
                
                <!-- Subnet p√∫blica -->
                <rect x="130" y="250" width="250" height="180" rx="12" fill="rgba(245,158,11,0.1)" stroke="#f59e0b" stroke-width="1"/>
                <text x="150" y="275" fill="#fbbf24" font-size="12" font-weight="600">DMZ Subnet (10.0.0.0/24)</text>
                
                <!-- Load Balancer -->
                <g class="component" data-tooltip="Azure Load Balancer: distribuye tr√°fico entrante. Health probes verifican estado del bot.">
                    <rect x="150" y="300" width="200" height="60" rx="8" fill="#0284c7" filter="url(#shadow)"/>
                    <text x="250" y="335" text-anchor="middle" fill="white" font-size="12" font-weight="600">‚öñÔ∏è Load Balancer</text>
                </g>
                
                <!-- Public IP -->
                <rect x="170" y="380" width="160" height="35" rx="6" fill="#0ea5e9"/>
                <text x="250" y="403" text-anchor="middle" fill="white" font-size="11">üìç Public IP: 40.x.x.x</text>
                
                <!-- Subnet privada -->
                <rect x="410" y="250" width="270" height="380" rx="12" fill="rgba(16,185,129,0.1)" stroke="#10b981" stroke-width="1"/>
                <text x="430" y="275" fill="#34d399" font-size="12" font-weight="600">Private Subnet (10.0.1.0/24)</text>
                
                <!-- Container -->
                <g class="component" data-tooltip="Container con el bot. Solo accesible desde Load Balancer. Outbound via NAT Gateway.">
                    <rect x="430" y="300" width="230" height="80" rx="8" fill="url(#botGrad)" filter="url(#shadow)"/>
                    <text x="545" y="335" text-anchor="middle" fill="white" font-size="13" font-weight="600">üê≥ Bot Container</text>
                    <text x="545" y="360" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="10">10.0.1.10 (Private IP)</text>
                </g>
                
                <!-- Key Vault -->
                <g class="component" data-tooltip="Key Vault con Private Endpoint. Los secretos nunca salen de la VNet.">
                    <rect x="430" y="400" width="230" height="60" rx="8" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="545" y="435" text-anchor="middle" fill="white" font-size="12" font-weight="600">üîë Key Vault (Private Endpoint)</text>
                </g>
                
                <!-- Storage -->
                <g class="component" data-tooltip="Storage Account con Private Endpoint. Los archivos WAV no son accesibles desde Internet.">
                    <rect x="430" y="480" width="230" height="60" rx="8" fill="url(#storageGrad)" filter="url(#shadow)"/>
                    <text x="545" y="515" text-anchor="middle" fill="white" font-size="12" font-weight="600">üíæ Storage (Private Endpoint)</text>
                </g>
                
                <!-- NAT Gateway -->
                <g class="component" data-tooltip="NAT Gateway: permite salida a Internet (APIs externas) sin exponer IPs privadas.">
                    <rect x="430" y="560" width="230" height="60" rx="8" fill="#6366f1" filter="url(#shadow)"/>
                    <text x="545" y="595" text-anchor="middle" fill="white" font-size="12" font-weight="600">üö™ NAT Gateway</text>
                </g>
                
                <!-- Servicios externos -->
                <rect x="750" y="190" width="400" height="460" rx="16" fill="rgba(139,92,246,0.1)" stroke="#8b5cf6" stroke-width="2"/>
                <text x="780" y="220" fill="#a78bfa" font-size="14" font-weight="600">‚òÅÔ∏è Servicios Externos (via NAT)</text>
                
                <!-- Microsoft 365 -->
                <g class="component" data-tooltip="Microsoft 365: comunicaci√≥n via HTTPS (443). Autenticaci√≥n OAuth2.">
                    <rect x="780" y="260" width="340" height="80" rx="10" fill="url(#teamsGrad)" filter="url(#shadow)"/>
                    <text x="950" y="295" text-anchor="middle" fill="white" font-size="14" font-weight="600">Microsoft 365</text>
                    <text x="950" y="320" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">graph.microsoft.com:443</text>
                </g>
                
                <!-- OpenAI -->
                <g class="component" data-tooltip="OpenAI API: comunicaci√≥n via HTTPS. API Key almacenada en Key Vault.">
                    <rect x="780" y="360" width="340" height="80" rx="10" fill="url(#aiGrad)" filter="url(#shadow)"/>
                    <text x="950" y="395" text-anchor="middle" fill="white" font-size="14" font-weight="600">OpenAI API</text>
                    <text x="950" y="420" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">api.openai.com:443</text>
                </g>
                
                <!-- Azure AD -->
                <g class="component" data-tooltip="Azure AD: autenticaci√≥n del bot. Token obtenido via Client Credentials Flow.">
                    <rect x="780" y="460" width="340" height="80" rx="10" fill="url(#azureGrad)" filter="url(#shadow)"/>
                    <text x="950" y="495" text-anchor="middle" fill="white" font-size="14" font-weight="600">Azure AD</text>
                    <text x="950" y="520" text-anchor="middle" fill="rgba(255,255,255,0.8)" font-size="11">login.microsoftonline.com:443</text>
                </g>
                
                <!-- Flechas -->
                <path d="M600 160 L250 295" stroke="#f59e0b" stroke-width="2" marker-end="url(#arrowhead)"/>
                <text x="400" y="210" fill="#94a3b8" font-size="10">HTTPS (443)</text>
                
                <path d="M350 330 L425 340" stroke="#60a5fa" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <path d="M660 340 L750 300" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M660 340 L750 400" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowhead)"/>
                <path d="M660 340 L750 500" stroke="#a78bfa" stroke-width="2" marker-end="url(#arrowhead)"/>
                
                <!-- Reglas NSG -->
                <rect x="130" y="460" width="250" height="160" rx="8" fill="rgba(239,68,68,0.1)" stroke="#ef4444" stroke-width="1"/>
                <text x="150" y="485" fill="#f87171" font-size="11" font-weight="600">üîê NSG Rules</text>
                <text x="150" y="510" fill="#9ca3af" font-size="10">Inbound:</text>
                <text x="160" y="528" fill="#86efac" font-size="9">‚úì 443 from Internet (WAF)</text>
                <text x="160" y="544" fill="#86efac" font-size="9">‚úì 8443 from Azure Bot Service</text>
                <text x="160" y="560" fill="#fca5a5" font-size="9">‚úó All other DENY</text>
                <text x="150" y="582" fill="#9ca3af" font-size="10">Outbound:</text>
                <text x="160" y="600" fill="#86efac" font-size="9">‚úì 443 to graph.microsoft.com</text>
                <text x="160" y="616" fill="#86efac" font-size="9">‚úì 443 to api.openai.com</text>
            </svg>
            
            <div class="legend">
                <h3>Puertos y Protocolos</h3>
                <div class="legend-items">
                    <div class="legend-item"><span>‚Ä¢ 443/TCP: HTTPS (Graph API, OpenAI, Azure AD)</span></div>
                    <div class="legend-item"><span>‚Ä¢ 8443/TCP: Azure Bot Service media (opcional)</span></div>
                    <div class="legend-item"><span>‚Ä¢ Private Endpoints: Sin exposici√≥n a Internet</span></div>
                </div>
            </div>
            
            <div class="description">
                <strong>Mejores pr√°cticas de seguridad:</strong> 
                Private Endpoints para Key Vault y Storage, NAT Gateway para salida controlada, 
                NSG restrictivo, WAF para protecci√≥n contra ataques, Managed Identity para autenticaci√≥n sin secretos en c√≥digo.
            </div>
        </div>
    </div>
    
    <!-- Tooltip -->
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        function showDiagram(id) {
            // Ocultar todos los diagramas
            document.querySelectorAll('.diagram').forEach(d => d.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            
            // Mostrar el seleccionado
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Tooltips
        const tooltip = document.getElementById('tooltip');
        
        document.querySelectorAll('.component').forEach(component => {
            component.addEventListener('mouseenter', (e) => {
                const text = component.dataset.tooltip;
                if (text) {
                    tooltip.textContent = text;
                    tooltip.classList.add('visible');
                }
            });
            
            component.addEventListener('mousemove', (e) => {
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
            });
            
            component.addEventListener('mouseleave', () => {
                tooltip.classList.remove('visible');
            });
        });
    </script>
</body>
</html>
